{% extends '_base.html' %}

{% block content %}
  <div class="top-section top-section--od500-header top-section--main-color">
    <h1>All Companies</h1>
  </div>
  
  {# TODO
    Implement list.js in this table 
    Implement JS to make THEAD position:fixed - needs to add the class .table-sortable--fixed to the .table-sortable component, when thead reaches top of viewport.
  #}



<div id="company_data">
  <table class="table-sortable table-sortable--main-color"> {# .table-sortable--fixed #}
    
    <thead class="company">
      <th class="table-sortable__head-cell">&nbsp;</th>
      <th class="table-sortable__head-cell company__name">
        <span>Company</span>
      
        <div class="table-sortable__control-group">
          <span class="table-sortable__control table-sortable__control--simple js-open-table-search" data-target="#company__name--input"><i class="material-icons">search</i></span>
          <span class="table-sortable__control table-sortable__control--simple sort" data-sort="company__name"><i class="material-icons">keyboard_arrow_down</i></span>
        </div>
        <form class="table-sortable__search ">
          <input id="company__name--input" class="search" type="text" placeholder="Filter by text">
          <button type="submit" class=""><i class="material-icons">close</i></button>
        </form>
      </th>

      <th class="table-sortable__head-cell company__category">
        <span>Category</span>
        <div class="table-sortable__control-group">
          <span class="table-sortable__control table-sortable__control--simple sort" data-sort="company__category"><i class="material-icons">keyboard_arrow_down</i></span>
        </div>
      </th>
      <th class="table-sortable__head-cell company__type">
        <span>Type</span>
        <div class="table-sortable__control-group">
          <span class="table-sortable__control table-sortable__control--simple sort" data-sort="company__type"><i class="material-icons">keyboard_arrow_down</i></span>
        </div>
      </th>

      <th class="table-sortable__head-cell company__founded">
        <span>Founded</span>
        <div class="table-sortable__control-group">
          <span class="table-sortable__control table-sortable__control--simple sort" data-sort="company__founded"><i class="material-icons">keyboard_arrow_down</i></span>
        </div>
      </th>
      <th class="table-sortable__head-cell company__location">
        <span>Location</span>
        <div class="table-sortable__control-group">
          <span class="table-sortable__control table-sortable__control--simple js-open-table-search" data-target="#company__location--input"><i class="material-icons">search</i></span>
          <span class="table-sortable__control table-sortable__control--simple sort" data-sort="company__location"><i class="material-icons">keyboard_arrow_down</i></span>  
        </div>
        <form class="table-sortable__search ">
          <input id="company__location--input" class="search" type="text" placeholder="Filter by text">
          <button type="submit" class=""><i class="material-icons">close</i></button>
        </form>
      </th>
      <th class="table-sortable__head-cell company__last-update">
        <span>Last Update</span>
        <div class="table-sortable__control-group">
          <span class="table-sortable__control table-sortable__control--simple sort" data-sort="company__last-update"><i class="material-icons">keyboard_arrow_down</i></span>
        </div>
      </th>
      <th class="table-sortable__head-cell">&nbsp;</th>
    </thead>
    <tbody class="list">
      {% for i in companies %}
      <tr class="company" id="{{i.company_name_id}}" >
        <td></td>
        <td class="company__name"><a href="{{i.url}}" target="_blank">{{i.company_name}}</a></td>
        <td class="company__category">{{i.company_category}}</td>
        <td class="company__type">{{i.company_type}}</td>
        <td class="company__founded" data-timestamp={{i.year_founded}}>{{i.year_founded}}</td>
        {# {% set location =  %} #}
        <td class="company__location">{{i.city}}, {{i.state}}</td>
        {# Need to have a custom filter in nunjucks to format the datetime entry #}
        <td class="company__last-update" data-timestamp={{i.last_updated}} >{{i.last_updated | truncate(10) }}</td>
        
        <td></td>
      </tr>
      {% endfor %}
    </tbody>

  </table>  

  </div>
  
  
{% endblock %}

{% block script %}
<script>
// Fixed Table Header
$(window).scroll(function(){
    var yPosition = $( window ).scrollTop(),
        target = $('.table-sortable'),
        offset = target.offset().top;
    yPosition >= offset ? target.addClass("table-sortable--fixed") : target.removeClass("table-sortable--fixed");
});
</script>
{% endblock %}